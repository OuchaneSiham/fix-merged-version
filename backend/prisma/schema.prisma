generator client {
  provider = "prisma-client-js"
}
datasource db {
  provider = "postgresql"
}

model User {
  id               Int          @id @default(autoincrement())
  username         String       @unique
  email            String       @unique
  password         String?
  googleId         String?      @unique 
  avatar           String @default("/uploads/default.png") 
  role             String       @default("user") 
  isOnline         Boolean      @default(false)   
  twoFactorEnabled Boolean      @default(false)  
  twoFactorSecret  String?  
  
  sentRequests     Friendship[] @relation("SentRequests")
  receivedRequests Friendship[] @relation("ReceivedRequests")
  messages             Message[]
  conversationsAsUser1 Conversation[] @relation("User1Conversations")
  conversationsAsUser2 Conversation[] @relation("User2Conversations")
  blockedUsers         BlockedUser[]  @relation("BlockedUsers")
  blockedBy            BlockedUser[]  @relation("BlockedBy")
  @@map("user")
}

model Friendship {
  id          Int      @id @default(autoincrement())
  status      String   @default("pending")
  requester   User     @relation("SentRequests", fields: [requesterId], references: [id])
  requesterId Int
  addressee   User     @relation("ReceivedRequests", fields: [addresseeId], references: [id])
  addresseeId Int

  createdAt   DateTime @default(now())
  @@unique([requesterId, addresseeId])
}
model BlockedUser {
  id            Int      @id @default(autoincrement())
  userId        Int
  blockedUserId Int
  user          User     @relation("BlockedUsers", fields: [userId], references: [id])
  blockedUser   User     @relation("BlockedBy", fields: [blockedUserId], references: [id])
  @@unique([userId, blockedUserId])
}

model Conversation {
  id       Int       @id @default(autoincrement())
  user1Id  Int
  user2Id  Int
  user1    User      @relation("User1Conversations", fields: [user1Id], references: [id])
  user2    User      @relation("User2Conversations", fields: [user2Id], references: [id])
  messages Message[]
  @@unique([user1Id, user2Id])
}

model Message {
  id             Int          @id @default(autoincrement())
  content        String
  senderId       Int
  conversationId Int
  sender         User         @relation(fields: [senderId], references: [id])
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  createdAt      DateTime     @default(now())
}